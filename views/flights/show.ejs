<%- include('../partials/header') %>

<h2>Flight Details</h2>
<section id="show-page">
  <div>Airline: <%= flight.airline %></div>
  <br>
  <div>Flight Number: <%= flight.flightNo %></div>
  <br>
  <div>Departure Details: </div> 
    <ul class="flight-info">
        <li class="airport-code">Departure Airport: <%= flight.airport %></li>
        <li class="departure-date">Date & Time: <%= flight.departureDate %></li>
    </ul>
  <div>Arrival Details: </div>
    <ul class="flight-info">
        <% if (flight.destination.length) { %>
        <% flight.destination.forEach(function(item) { %>
          <li class="airport-code">Destination Airport: <%= item.destination %></li>
          <li class="arrival-date">Date & Time: <%= item.arrivalDate %></li>
        </ul>
        <% }); %>  
        <% }; %>  
</section>

<br>

<section>

<h2>Add a Destination</h2>

<form id="add-destination-form" method="POST" action="/flights/<%= flight._id %>/destinations">
    <label>Airport Destination:</label>
        <select name="destination">
            <option value="(ATL) Atlanta, GA">(ATL) Atlanta, GA</option>
            <option value="(AUS) Austin, TX">(AUS) Austin, TX</option>
            <option value="(DFW) Dallas, TX">(DFW) Dallas, TX</option>
            <option value="(DEN) Denver, CO">(DEN) Denver, CO</option>
            <option value="(JFK) New York, NY">(JFK) New York, NY</option>
            <option value="(LAX) Los Angeles, CA">(LAX) Los Angeles, CA</option>
            <option value="(MCO) Orlando, FL">(MCO) Orlando, FL</option>
            <option value="(MIA) Miami, FL">(MIA) Miami, FL</option>
            <option value="(SAN) San Diego, CA">(SAN) San Diego, CA</option>
            <option value="(SEA) Seattle, WA">(SEA) Seattle, WA</option>
            <option value="(SFO) San Francisco, CA">(SFO) San Francisco, CA</option>
        </select>
    <br><br>  
    <label>Arrival Date & Time:</label>
    <input type="datetime-local" name="arrivalDate" required>
<br><br><br>
  <input type="submit" value="Add Destination">
</form>

</section>

<section>

</form>
<br><br><h2>Add Ticket to this Flight</h2>
<form id="add-ticket-form" method="POST"
  action="/flights/<%= flight._id %>/tickets">
  <label>Flight Number:</label>
    <input type="text" name="flightNo" pattern="/[A-F][1-9]\d?/" placeholder="i.e. A1" required>
    <label>Price:</label>
    <input type="number" name="flightPrice" pattern="\d{4}\.\d{2}/" placeholder="i.e. 349.50" required>
  <input type="submit" value="Add Ticket">
</form>

  <% if (flight.tickets.length) { %>
    <table>
      <thead>
        <tr>
          <th>Seat</th>
          <th>Price</th>
          <th>Flight</th>
        </tr>
      </thead>
      <tbody>
        <!-- yes! we can define variables -->
        <% let total = 0 %>
        <% flight.tickets.forEach(function(t) { %>
          <!-- accumulate the total rating -->
          <% total += t.flight %>
          <tr>
            <!-- .toLocaleDateString() provides a more friendly date format -->
            <td><%= t.createdAt.toLocaleDateString() %></td>
            <td><%= t.seat %></td>
            <td><%= t.price %></td>
            <td><%= t.flight %></td>
          </tr>
        <% }); %>
        <!-- add a row to display the average AFTER the forEach iteration -->
        <tr>
            <td colspan="2"></td>
            <td><strong><%=(total / flight.tickets.length).toFixed(1) %></strong></td>
        </tr>
      </tbody>
    </table>
  <% } else { %>
    <h5>No Tickets Yet</h5>
  <% } %>

</section>

<%- include('../partials/footer') %>
